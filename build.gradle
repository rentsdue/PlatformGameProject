plugins {
    id 'java'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.jsweet:jsweet-core:3.2.0' // Use the latest version
    implementation 'org.jsweet:jsweet-transpiler:3.2.0' // Use the latest version
    implementation 'org.jsweet.candies.jsweet.candies-angular:jsweet-candies-angular:1.6.9' // Example dependency for JSweet
    implementation 'javax.servlet:javax.servlet-api:3.1.0'
    testImplementation 'junit:junit:4.13.1'
}

sourceSets {
    main {
        java {
            srcDirs 'src/main/java'
        }
        resources {
            srcDirs 'src/main/resources'
        }
    }
}

task transpileToJS(type: JavaExec) {
    group = 'build'
    description = 'Transpile Java code to JavaScript using JSweet'
    classpath = sourceSets.main.runtimeClasspath
    main = 'org.jsweet.transpiler.JSweetTranspiler'
    args = ['src/main/', '-d', 'build/js', '-tsOut', 'build/ts']
}


compileJava {
    options.compilerArgs << '-proc:none' // Disable annotation processing for this task
}

task copyWebResources(type: Copy) {
    dependsOn transpileToJS // Ensure this task runs after transpileToJS
    from 'src/main/'
    into 'build/js'
}

// Ensure copyWebResources task runs after transpileToJS completes
transpileToJS.finalizedBy(copyWebResources)
